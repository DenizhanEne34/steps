<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Receipt Generator</title>
    <!-- Load React, ReactDOM, and Tailwind CSS from CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide icons library -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Define the font styles for the whole document */
        :root {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for printing */
        @media print {
            body * {
                visibility: hidden;
            }
            #receipt-preview, #receipt-preview * {
                visibility: visible;
            }
            #receipt-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            /* Ensure minimal margins when saving to PDF */
            @page {
                size: auto;
                margin: 0mm;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="root"></div>

    <!-- The main application code - Now using pure JavaScript (no Babel needed) -->
    <script>
        // --- Core Dependency Check ---
        // If React or ReactDOM fail to load from CDN, display an error message.
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            document.getElementById('root').innerHTML = `
                <div class="p-8 bg-red-100 border border-red-400 text-red-700 rounded-xl max-w-xl mx-auto mt-20 shadow-xl">
                    <h3 class="text-2xl font-bold mb-4">Deployment Error: Core Libraries Missing</h3>
                    <p>The browser could not load the necessary files (React/ReactDOM) from the internet.</p>
                    <ul class="list-disc list-inside mt-3 text-sm">
                        <li>This usually means a temporary network blockage or a CDN failure.</li>
                        <li>Please check your internet connection and try reloading.</li>
                        <li>If deployed, confirm your hosting provider (like Netlify) is allowing external script loading.</li>
                    </ul>
                </div>
            `;
        } else {
            // --- Application Logic Starts Here ---
            const { useState, createElement: e } = React;
            const root = ReactDOM.createRoot(document.getElementById('root'));

            // Helper function for Lucide icons (must be called after lucide.js loads)
            const Icon = ({ name, className }) => {
                const iconElement = lucide.createIcons()[name];
                return iconElement ? e('div', { className, dangerouslySetInnerHTML: { __html: iconElement } }) : null;
            };

            // Custom component mapping icons used in the app
            const Calculator = (props) => e(Icon, { name: 'Calculator', ...props });
            const Plus = (props) => e(Icon, { name: 'Plus', ...props });
            const Trash2 = (props) => e(Icon, { name: 'Trash2', ...props });
            const Printer = (props) => e(Icon, { name: 'Printer', ...props });


            function App() {
            // -- State --
            const [data, setData] = useState({
                company: 'CITY MZARA ARTVİN CEYLAN',
                docNo: 'T-0004429',
                date: new Date().toLocaleString('tr-TR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }).replace(',', ''),
                staff: 'ZEYNEP',
                prevBalance: 0,
            });

            const [items, setItems] = useState([
                { id: '1', code: '26K2027-B', color: 'BORDO', qty: 4, price: 675.00 },
                { id: '2', code: '26K2027-B', color: 'KAHVE', qty: 4, price: 675.00 },
                { id: '3', code: '26K2027-B', color: 'SIYAH', qty: 4, price: 675.00 },
            ]);

            // -- Calculations --
            const totalQty = items.reduce((sum, item) => sum + item.qty, 0);
            const totalAmount = items.reduce((sum, item) => sum + (item.qty * item.price), 0);
            const kdvRate = 0.10; // 10% based on the image (8100 -> 810)
            const kdvAmount = totalAmount * kdvRate;
            const netAmount = totalAmount + kdvAmount;
            const currentBalance = data.prevBalance + netAmount;

            // -- Handlers --
            const handleDataChange = (e) => {
                const { name, value } = e.target;
                setData(prev => ({
                ...prev,
                [name]: name === 'prevBalance' ? parseFloat(value) || 0 : value
                }));
            };

            const handleItemChange = (id, field, value) => {
                setItems(prev => prev.map(item => {
                if (item.id === id) {
                    // Parse number fields correctly
                    let newValue = value;
                    if (field === 'qty') {
                        newValue = parseInt(value) || 0;
                    }
                    if (field === 'price') {
                        newValue = parseFloat(value) || 0;
                    }
                    return { ...item, [field]: newValue };
                }
                return item;
                }));
            };

            const addItem = () => {
                setItems(prev => [
                ...prev,
                { id: Date.now().toString(), code: '', color: '', qty: 1, price: 0 }
                ]);
            };

            const removeItem = (id) => {
                setItems(prev => prev.filter(item => item.id !== id));
            };

            const handlePrint = () => {
                window.print();
            };

            // -- Formatting Helpers --
            const formatMoney = (amount) => {
                return amount.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            };

            // This is the main render function, replacing JSX/TSX
            return (
                e('div', { className: "min-h-screen bg-gray-100 p-4 font-sans text-gray-800 print:bg-white print:p-0" },
                    // Header / Controls - Hidden in Print
                    e('div', { className: "max-w-6xl mx-auto mb-6 flex justify-between items-center print:hidden" },
                        e('h1', { className: "text-2xl font-bold text-gray-700 flex items-center gap-2" },
                            e(Calculator, { className: "w-8 h-8 text-blue-600" }),
                            "Digital Receipt Generator"
                        ),
                        e('button', {
                            onClick: handlePrint,
                            className: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold flex items-center gap-2 shadow-sm transition-colors"
                        },
                            e(Printer, { className: "w-5 h-5" }),
                            "Print / Save as PDF"
                        )
                    ),

                    e('div', { className: "max-w-6xl mx-auto flex flex-col lg:flex-row gap-8 print:block" },
                        
                        // LEFT PANEL: Editor Form - Hidden in Print
                        e('div', { className: "flex-1 bg-white p-6 rounded-xl shadow-sm print:hidden h-fit" },
                            e('h2', { className: "text-lg font-semibold mb-4 border-b pb-2" }, "Receipt Details"),
                            
                            // Header Info
                            e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" },
                                e('div', null,
                                    e('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, "Firma"),
                                    e('input', { 
                                        type: "text", name: "company", value: data.company, onChange: handleDataChange,
                                        className: "w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, "Belge No"),
                                    e('input', { 
                                        type: "text", name: "docNo", value: data.docNo, onChange: handleDataChange,
                                        className: "w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, "Tarih (E.g., 28.11.2025 15:40)"),
                                    e('input', { 
                                        type: "text", name: "date", value: data.date, onChange: handleDataChange,
                                        className: "w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, "Personel"),
                                    e('input', { 
                                        type: "text", name: "staff", value: data.staff, onChange: handleDataChange,
                                        className: "w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                                    })
                                )
                            ),

                            // Items List
                            e('h3', { className: "text-md font-semibold mb-3" }, "Items"),
                            e('div', { className: "space-y-3 mb-6" },
                                items.map((item) => (
                                    e('div', { key: item.id, className: "flex flex-wrap gap-2 items-end p-3 bg-gray-50 rounded-lg border" },
                                        e('div', { className: "flex-1 min-w-[120px]" },
                                            e('label', { className: "text-xs text-gray-500" }, "Kodu"),
                                            e('input', { 
                                                type: "text", value: item.code, 
                                                onChange: (e) => handleItemChange(item.id, 'code', e.target.value),
                                                className: "w-full border rounded px-2 py-1 text-sm"
                                            })
                                        ),
                                        e('div', { className: "flex-1 min-w-[100px]" },
                                            e('label', { className: "text-xs text-gray-500" }, "Renk"),
                                            e('input', { 
                                                type: "text", value: item.color, 
                                                onChange: (e) => handleItemChange(item.id, 'color', e.target.value),
                                                className: "w-full border rounded px-2 py-1 text-sm"
                                            })
                                        ),
                                        e('div', { className: "w-20" },
                                            e('label', { className: "text-xs text-gray-500" }, "Adet"),
                                            e('input', { 
                                                type: "number", value: item.qty, 
                                                onChange: (e) => handleItemChange(item.id, 'qty', e.target.value),
                                                className: "w-full border rounded px-2 py-1 text-sm text-right",
                                                min: "0"
                                            })
                                        ),
                                        e('div', { className: "w-24" },
                                            e('label', { className: "text-xs text-gray-500" }, "Fiyat"),
                                            e('input', { 
                                                type: "number", value: item.price, 
                                                onChange: (e) => handleItemChange(item.id, 'price', e.target.value),
                                                className: "w-full border rounded px-2 py-1 text-sm text-right",
                                                step: "0.01", min: "0"
                                            })
                                        ),
                                        e('button', { 
                                            onClick: () => removeItem(item.id),
                                            className: "p-2 text-red-500 hover:bg-red-50 rounded",
                                            title: "Remove Item"
                                        },
                                            e(Trash2, { className: "w-4 h-4" })
                                        )
                                    )
                                )),
                                e('button', { 
                                    onClick: addItem,
                                    className: "w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-500 hover:text-blue-500 flex justify-center items-center gap-2 transition-colors"
                                },
                                    e(Plus, { className: "w-4 h-4" }),
                                    " Add Item"
                                )
                            )
                        ),

                        // Financials
                        e('div', { className: "border-t pt-4" },
                            e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                e('div', null,
                                    e('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, "Önceki Bakiye"),
                                    e('input', { 
                                        type: "number", name: "prevBalance", value: data.prevBalance, onChange: handleDataChange,
                                        className: "w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",
                                        step: "0.01"
                                    })
                                )
                            )
                        ),

                        // RIGHT PANEL: The Receipt Preview
                        e('div', { className: "flex-1 flex justify-center print:block print:w-full print:h-full" },
                            e('div', { 
                                id: "receipt-preview",
                                className: "bg-white text-black font-mono text-sm leading-tight w-[380px] min-h-[600px] shadow-2xl print:shadow-none p-6 relative print:w-full print:max-w-[400px] print:mx-auto print:absolute print:top-0 print:left-0",
                                style: { fontFamily: '"Courier New", Courier, monospace' }
                            },
                                // Logo Area Placeholder
                                e('div', { className: "text-center mb-8" },
                                    e('h1', { className: "text-3xl font-bold tracking-widest mb-1" }, "STEPS"),
                                    e('p', { className: "text-xs tracking-[0.3em] text-gray-600" }, "WHOLESALE")
                                ),

                                // Header Info Table
                                e('div', { className: "mb-4 text-[13px] space-y-1" },
                                    e('div', { className: "flex" },
                                        e('span', { className: "w-24" }, "Firma"),
                                        e('span', { className: "mr-2" }, ":"),
                                        e('span', { className: "uppercase" }, data.company)
                                    ),
                                    e('div', { className: "flex" },
                                        e('span', { className: "w-24" }, "Belge No"),
                                        e('span', { className: "mr-2" }, ":"),
                                        e('span', null, data.docNo)
                                    ),
                                    e('div', { className: "flex" },
                                        e('span', { className: "w-24" }, "Tarih"),
                                        e('span', { className: "mr-2" }, ":"),
                                        e('span', null, data.date)
                                    ),
                                    e('div', { className: "flex" },
                                        e('span', { className: "w-24" }, "Personel"),
                                        e('span', { className: "mr-2" }, ":"),
                                        e('span', { className: "uppercase" }, data.staff)
                                    )
                                ),

                                // Divider
                                e('div', { className: "border-b border-black border-dashed my-2" }),

                                // Items Table Header
                                e('div', { className: "flex text-[13px] font-bold mb-2" },
                                    e('span', { className: "w-24" }, "KODU"),
                                    e('span', { className: "w-16" }, "RENK"),
                                    e('span', { className: "w-10 text-right" }, "ADET"),
                                    e('span', { className: "w-20 text-right" }, "FIYAT"),
                                    e('span', { className: "flex-1 text-right" }, "TUTAR")
                                ),

                                // Items List
                                e('div', { className: "space-y-1 mb-4" },
                                    items.map((item) => (
                                        e('div', { key: item.id, className: "flex text-[13px]" },
                                            e('span', { className: "w-24 truncate pr-1" }, item.code),
                                            e('span', { className: "w-16 truncate pr-1" }, item.color),
                                            e('span', { className: "w-10 text-right" }, item.qty),
                                            e('span', { className: "w-20 text-right" }, formatMoney(item.price)),
                                            e('span', { className: "flex-1 text-right" }, formatMoney(item.qty * item.price))
                                        )
                                    ))
                                ),

                                // Empty Lines Filler
                                e('div', { className: "h-4" }),

                                // Divider
                                e('div', { className: "border-b border-black border-dashed my-2" }),

                                // Totals Section
                                e('div', { className: "space-y-1 font-bold text-[14px]" },
                                    e('div', { className: "flex justify-between" },
                                        e('span', null, "Toplam Miktar"),
                                        e('span', null, totalQty)
                                    ),
                                    e('div', { className: "flex justify-between" },
                                        e('span', null, "Toplam Tutar"),
                                        e('span', null, formatMoney(totalAmount))
                                    )
                                ),

                                e('div', { className: "h-4" }),

                                e('div', { className: "space-y-1 font-bold text-[14px]" },
                                    e('div', { className: "flex justify-between" },
                                        e('span', null, "KDV Tutarı"),
                                        e('span', null, formatMoney(kdvAmount))
                                    ),
                                    e('div', { className: "flex justify-between" },
                                        e('span', null, "Net Tutar"),
                                        e('span', null, formatMoney(netAmount))
                                    )
                                ),

                                // Divider
                                e('div', { className: "border-b border-black border-dashed my-2" }),

                                // Balance Section
                                e('div', { className: "space-y-1 font-bold text-[14px]" },
                                e('div', { className: "flex justify-between" },
                                        e('span', null, "Önceki Bakiye"),
                                        e('span', null, formatMoney(data.prevBalance))
                                    ),
                                    e('div', { className: "flex justify-between" },
                                        e('span', null, "Bu Fiş Tutarı"),
                                        e('span', null, formatMoney(netAmount))
                                    ),
                                    e('div', { className: "flex justify-between" },
                                        e('span', null, "Güncel Bakiye"),
                                        e('span', null, formatMoney(currentBalance))
                                    )
                                ),

                                // Divider
                                e('div', { className: "border-b border-black border-dashed my-2" }),

                                // Footer / QR Codes
                                e('div', { className: "mt-6" },
                                    e('div', { className: "flex justify-around mb-2 text-center font-bold text-sm" },
                                    e('span', null, "instagram"),
                                    e('span', null, "telegram")
                                    ),
                                    e('div', { className: "flex justify-around mb-4" },
                                        // QR codes are loaded from a public API
                                        e('img', { 
                                            src: `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://instagram.com/stepswholesale`, 
                                            alt: "Instagram QR", 
                                            className: "w-24 h-24",
                                            // Fallback placeholder image
                                            onError: (e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/100x100/94A3B8/ffffff?text=IG'; }
                                        }),
                                        e('img', { 
                                            src: `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://t.me/stepswholesale`, 
                                            alt: "Telegram QR", 
                                            className: "w-24 h-24",
                                            // Fallback placeholder image
                                            onError: (e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/100x100/94A3B8/ffffff?text=TG'; }
                                        })
                                    ),

                                    e('div', { className: "text-center text-[12px] font-bold space-y-1" },
                                        e('div', null, "Turkish: +90 542 110 69 45"),
                                        e('div', null, "English: +90 542 182 78 17"),
                                        e('div', { className: "pt-1" }, "www.stepswholesale.com")
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Render the application to the root element
            window.addEventListener('load', () => {
                root.render(e(App));
            });
        }
    </script>
</body>
</html>
